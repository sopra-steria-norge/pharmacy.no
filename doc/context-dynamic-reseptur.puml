@startuml

actor Apotektekniker
actor Farmasøyt
box "Difa tjenesten"
    participant Difa
    database HPR
    database Farmalogg
end box
database Personregisteret
database RF
participant HELFO

activate Difa
Apotektekniker -> Difa: Find person basert på kriterier
Difa -> Personregisteret
Apotektekniker <-- Difa: Liste med personer
deactivate Difa

Apotektekniker -> Difa: Hent resepter for person
activate Difa
Difa -> RF: Hent resepter for person
Apotektekniker <-- Difa: Reseptliste
deactivate Difa

Apotektekniker -> Difa: Ekspeder resept
activate Difa
Difa -> RF: Ekspeder resept
Difa -> HPR: Hent rekvisisjonsrett
Difa -> Farmalogg: Medikament-informasjon
Difa <-- Farmalogg: Bivirkninger, interaksjoner, trinnpris,\nbyttegruppe med legemiddeldetaljer
Difa -> Difa: Bruk historikk til å generere varsler
Apotektekniker <-- Difa: Reseptliste med alternativer,\nbivirkninger, varsler
deactivate Difa

group Utføres av Apotektekniker etter behov
Apotektekniker -> Difa: Beregne refusjon basert på varevalg
Apotektekniker -> Difa: Forfalskningskontroll
Apotektekniker -> Difa: Verifiser utlevering
end group

group Kan skje på andre tidspunkt
Farmasøyt -> Difa: Hent resepter klar til farmasøytkontroll
Farmasøyt -> Difa: Utfør farmasøytkontroll
end group


Apotektekniker -> Difa: Registrer utlevering med varevalg, strekkoder,\noppdatert etikett,\nfarmasøyts aksjon for alle varsler,\nunderskrift
activate Difa
Difa -> Difa: Verifiser rekvirent, varsler, strekkoder
Difa -> RF: Utleveringsmelding
Difa -> HELFO: Send refusjonskrav
Apotektekniker <-- Difa: OK/feilkoder
deactivate Difa

@enduml
