@startuml

title DIFA som Software-as-a-Service (SaaS) tjeneste

node Apotek1 #yellow
node Apotek2 #yellow
node ApotekN #yellow
node Kjede #yellow
node FHI
node data.norge.no

interface FarmasøytApp <<opsjon>> #lime

cloud DIFA {
    cloud NAN as "Point of delivery"
    
    node LegemiddelSync <<Java>> #lime
    node HPRSync <<Java>> #lime
    node Reseptur <<Java>> #lime
    node Resepthistorikk <<Java>> #lime
    node Farmasøytisk <<Java>> #lime

    database Legemidler <<PostgreSQL>> #lime
    database Resepter <<PostgreSQL>> #lime
    database Journal <<PostgreSQL>> #lime
    database HPR <<PostgreSQL>> #lime
    
    node KeyVault #lime

    Reseptur -down-> Resepter
    Reseptur -down-> KeyVault
    Reseptur -down-> Legemidler
    Resepthistorikk -down-> Resepter
    Farmasøytisk -down-> Journal
}

cloud DifaRapport {
    node Rapport #lime
    database RapportDB <<SQL Server>> #lime

    Rapport -down-> RapportDB
}

node FarmaLogg #Aquamarine
LegemiddelSync <-right- FarmaLogg
LegemiddelSync -down-> Legemidler

node Helsedir #Aquamarine
HPRSync <-right- Helsedir
HPRSync -down-> HPR


Resepter -right-> RapportDB: Anonymisering

cloud Internet

Apotek1 -down-> Kjede
Apotek2 -down-> Kjede
ApotekN -down-> Kjede
Kjede -down-> NAN
FarmasøytApp -down-> NAN
NAN -down-> Reseptur
NAN -down-> Resepthistorikk
NAN -down-> Farmasøytisk

Kjede -down-> Internet
FHI -down-> Internet
data.norge.no -down-> Internet
Internet -down-> Rapport

cloud NHN as "Norsk helsenett" #Aquamarine

package eHelse {
    node RF
    node HELFO
    node helsenorge.no
}

Reseptur -> NHN
NHN -down-> eHelse
@enduml
